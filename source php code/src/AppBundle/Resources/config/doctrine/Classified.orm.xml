<doctrine-mapping xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:schemaLocation="http://doctrine-project.org/schemas/orm/doctrine-mapping
                   https://raw.github.com/doctrine/doctrine2/master/doctrine-mapping.xsd">

    <entity name="App\AppBundle\Entity\Classified"
            table="classified"
            repository-class="App\AppBundle\Entity\Repository\ClassifiedRepository"
    >
        <id name="id" type="integer" column="id">
            <generator strategy="AUTO"/>
        </id>

        <field name="title" column="title" type="string" nullable="false"/>
        <field name="description" column="description" type="text" nullable="false"/>
        <field name="reminders" column="reminders" type="integer" nullable="false">
            <options>
                <option name="default">0</option>
            </options>
        </field>

        <field name="expired" column="expired" type="boolean" nullable="false">
            <options>
                <option name="default">0</option>
            </options>
        </field>
        <field name="approved" column="approved" type="boolean" nullable="true">
        </field>

        <field name="views" column="views" type="integer" nullable="false">
            <options>
                <option name="default">0</option>
            </options>
        </field>

        <field name="slug" column="slug" type="string" nullable="false"/>
        <field name="gender" column="gender" type="string" nullable="false"/>
        <field name="flag" column="flag" type="integer" nullable="false">
            <options>
                <option name="default">0</option>
            </options>
        </field>

        <field name="token" column="token" type="string" nullable="true"/>
        <field name="priority" column="priority" type="integer" nullable="false">
            <options>
                <option name="default">0</option>
            </options>
        </field>

        <field name="createdAt" column="created_at" type="datetime" nullable="false"/>
        <field name="updatedAt" column="updated_at" type="datetime" nullable="false"/>
        <field name="deletedAt" column="deleted_at" type="datetime" nullable="true"/>
        <field name="refreshedAt" column="refreshed_at" type="datetime" nullable="false"/>
        <field name="remindedAt" column="reminded_at" type="datetime" nullable="true"/>

        <field name="ip" column="ip" type="string" length="30" nullable="true"/>
        <field name="oldId" column="old_id" type="integer" length="5" nullable="true"/>
        <field name="allowedComments" column="allowed_comments" type="boolean">
            <options>
                <option name="default">0</option>
            </options>
        </field>

        <!--todo add images-->
        <one-to-many target-entity="App\ImageBundle\Entity\Image" mapped-by="classified" field="images">
            <cascade>
                <cascade-persist/>
                <cascade-remove/>
            </cascade>
        </one-to-many>

        <many-to-one field="canonical" target-entity="App\AppBundle\Entity\Classified">
            <join-column name="canonical_id" referenced-column-name="id" />
        </many-to-one>
        <many-to-one target-entity="App\AppBundle\Entity\Type" field="type" inversed-by="classifieds"/>
        <many-to-one target-entity="App\UserBundle\Entity\User" field="user" inversed-by="classifieds"/>
        <one-to-many target-entity="App\AppBundle\Entity\Message" field="messages" mapped-by="classified"/>

        <many-to-many target-entity="App\AppBundle\Entity\City" field="cities" fetch="EXTRA_LAZY"
                      inversed-by="classifieds">
            <join-table name="classifieds_to_cities">
                <join-columns>
                    <join-column name="classified_id"/>
                </join-columns>
                <inverse-join-columns>
                    <join-column name="city_id"/>
                </inverse-join-columns>
            </join-table>
            <cascade>
                <cascade-persist/>
            </cascade>
        </many-to-many>

        <unique-constraints>
            <unique-constraint name="slugx" columns="slug"/>
        </unique-constraints>

        <lifecycle-callbacks>
            <lifecycle-callback type="prePersist" method="updatedTimestamps"/>
            <lifecycle-callback type="preUpdate" method="updatedTimestamps"/>
        </lifecycle-callbacks>

    </entity>

</doctrine-mapping>
